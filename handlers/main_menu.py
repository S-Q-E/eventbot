import logging

from aiogram import Router, types, F
from aiogram.filters import Command
from aiogram.types import InlineKeyboardMarkup, InlineKeyboardButton
from db.database import get_db, User

main_menu_router = Router()


@main_menu_router.message(Command("main_menu"))
async def main_menu(message: types.Message):
    """
    Ğ¤ÑƒĞ½ĞºÑ†Ğ¸Ñ Ğ¿Ñ€Ğ¸Ğ²ĞµÑ‚ÑÑ‚Ğ²Ğ¸Ñ. ĞŸÑ€Ğ¸ ÑÑ‚Ğ°Ñ€Ñ‚Ğµ Ğ±Ğ¾Ñ‚Ğ° Ğ¿Ñ€ĞµĞ´Ğ»Ğ°Ğ³Ğ°ĞµÑ‚ÑÑ Ğ²Ñ‹Ğ±Ñ€Ğ°Ñ‚ÑŒ Ğ¾Ğ¿Ñ†Ğ¸Ñ
    """

    user_id = message.from_user.id
    db = next(get_db())

    try:
        user = db.query(User).filter_by(id=user_id).first()
    except Exception as e:
        await message.answer(f"ĞŸÑ€Ğ¾Ğ¸Ğ·Ğ¾ÑˆĞ»Ğ° Ğ¾ÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğµ Ğº Ğ±Ğ°Ğ·Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…. ĞŸĞ¾Ğ¿Ñ€Ğ¾Ğ±ÑƒĞ¹Ñ‚Ğµ Ğ¿Ğ¾Ğ·Ğ¶Ğµ. {e}")

        return

    events_button = InlineKeyboardButton(text="ğŸ’¬ Ğ”Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ñ‹Ğµ ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ñ", callback_data="events_page_1")
    admin_panel = InlineKeyboardButton(text="ğŸ˜ ĞŸĞ°Ğ½ĞµĞ»ÑŒ Ğ°Ğ´Ğ¼Ğ¸Ğ½Ğ°", callback_data="admin_panel")
    user_profile = InlineKeyboardButton(text="ğŸ‘¤ ĞœĞ¾Ğ¹ Ğ¿Ñ€Ğ¾Ñ„Ğ¸Ğ»ÑŒ", callback_data="user_profile")
    user_help = InlineKeyboardButton(text="ğŸ†˜ ĞŸĞ¾Ğ¼Ğ¾Ñ‰ÑŒ", callback_data="user_help")

    admin_markup = InlineKeyboardMarkup(inline_keyboard=[[events_button],
                                                         [admin_panel], [user_profile], [user_help]])

    reg_user_markup = InlineKeyboardMarkup(inline_keyboard=[[events_button], [user_profile], [user_help]])
    if user:
        if user.is_admin:
            await message.answer(f"ĞŸÑ€Ğ¸Ğ²ĞµÑ‚, {user.first_name} {user.last_name}!\n"
                                 f"âœ… Ğ­Ñ‚Ğ¾ Ğ¿Ñ€Ğ¸Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ğµ Ğ´Ğ»Ñ ÑƒÑ‡Ğ°ÑÑ‚Ğ½Ğ¸ĞºĞ¾Ğ² ÑĞ¿Ğ¾Ñ€Ñ‚Ğ¸Ğ²Ğ½Ñ‹Ñ… ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ğ¹\n"
                                 f"âœ… Ğ—Ğ´ĞµÑÑŒ Ğ²Ñ‹ Ğ½Ğ°Ğ¹Ğ´ĞµÑ‚Ğµ Ğ¿Ğ¾Ğ´Ñ…Ğ¾Ğ´ÑÑ‰ĞµĞµ Ğ·Ğ°Ğ½ÑÑ‚Ğ¸Ğµ Ğ´Ğ»Ñ ÑĞµĞ±Ñ, Ğ²Ñ‹Ğ±Ñ€Ğ°Ğ² Ğ»Ğ¾ĞºĞ°Ñ†Ğ¸Ñ Ğ¸ Ğ²Ñ€ĞµĞ¼Ñ.\n",
                                 reply_markup=admin_markup)
        else:
            await message.answer("ğŸ‰ğŸ‰ğŸ‰ğŸ‰ğŸ‰ EVENTBOT ğŸ‰ğŸ‰ğŸ‰ğŸ‰ğŸ‰\n\n"
                                 f"<b>Ğ”Ğ¾Ğ±Ñ€Ğ¾ Ğ¿Ğ¾Ğ¶Ğ°Ğ»Ğ¾Ğ²Ğ°Ñ‚ÑŒ! {message.from_user.username}</b>\n",
                                 reply_markup=reg_user_markup)
    else:
        await message.answer("ğŸ‰ğŸ‰ğŸ‰ğŸ‰ğŸ‰ EVENTBOT ğŸ‰ğŸ‰ğŸ‰ğŸ‰ğŸ‰\n\n"
                             f"<b>Ğ”Ğ¾Ğ±Ñ€Ğ¾ Ğ¿Ğ¾Ğ¶Ğ°Ğ»Ğ¾Ğ²Ğ°Ñ‚ÑŒ!</b>\n\n"
                             f"<b> Ğ’Ñ‹ Ğ½Ğµ Ğ¿Ñ€Ğ¾ÑˆĞ»Ğ¸ Ñ€ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ°Ñ†Ğ¸Ñ </b>\n"
                             f"<b> ĞŸĞ¾Ğ¶Ğ°Ğ»ÑƒĞ¹ÑÑ‚Ğ° Ğ¿Ñ€Ğ¾Ğ¹Ğ´Ğ¸Ñ‚Ğµ Ñ€ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ°Ñ†Ğ¸Ñ </b>")


@main_menu_router.callback_query(F.data == "main_menu")
async def main_menu(callback: types.CallbackQuery):
    """
    Ğ¤ÑƒĞ½ĞºÑ†Ğ¸Ñ Ğ¿Ñ€Ğ¸Ğ²ĞµÑ‚ÑÑ‚Ğ²Ğ¸Ñ. ĞŸÑ€Ğ¸ ÑÑ‚Ğ°Ñ€Ñ‚Ğµ Ğ±Ğ¾Ñ‚Ğ° Ğ¿Ñ€ĞµĞ´Ğ»Ğ°Ğ³Ğ°ĞµÑ‚ÑÑ Ğ²Ñ‹Ğ±Ñ€Ğ°Ñ‚ÑŒ Ğ¾Ğ¿Ñ†Ğ¸Ñ
    """

    user_id = callback.from_user.id
    db = next(get_db())

    try:
        user = db.query(User).filter_by(id=user_id).first()
    except Exception as e:
        await callback.message.answer("ĞŸÑ€Ğ¾Ğ¸Ğ·Ğ¾ÑˆĞ»Ğ° Ğ¾ÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğµ Ğº Ğ±Ğ°Ğ·Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…. ĞŸĞ¾Ğ¿Ñ€Ğ¾Ğ±ÑƒĞ¹Ñ‚Ğµ Ğ¿Ğ¾Ğ·Ğ¶Ğµ.")
        logging.info(f"ĞÑˆĞ¸Ğ±ĞºĞ° Ğ² main_menu: {e}")
        return

    events_button = InlineKeyboardButton(text="ğŸ’¬ Ğ”Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ñ‹Ğµ ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ñ", callback_data="events_page_1")
    admin_panel = InlineKeyboardButton(text="ğŸ˜ ĞŸĞ°Ğ½ĞµĞ»ÑŒ Ğ°Ğ´Ğ¼Ğ¸Ğ½Ğ°", callback_data="admin_panel")
    user_profile = InlineKeyboardButton(text="ğŸ‘¤ ĞœĞ¾Ğ¹ Ğ¿Ñ€Ğ¾Ñ„Ğ¸Ğ»ÑŒ", callback_data="user_profile")
    user_help = InlineKeyboardButton(text="ğŸ†˜ ĞŸĞ¾Ğ¼Ğ¾Ñ‰ÑŒ", callback_data="user_help")

    admin_markup = InlineKeyboardMarkup(inline_keyboard=[[events_button],
                                                         [admin_panel], [user_profile], [user_help]])

    reg_user_markup = InlineKeyboardMarkup(inline_keyboard=[[events_button], [user_profile], [user_help]])
    if user:
        if user.is_admin:
            await callback.message.answer("ğŸ‰ğŸ‰ğŸ‰ğŸ‰ğŸ‰ EVENTBOT ğŸ‰ğŸ‰ğŸ‰ğŸ‰ğŸ‰\n\n"
                                          f"<b>Ğ”Ğ¾Ğ±Ñ€Ğ¾ Ğ¿Ğ¾Ğ¶Ğ°Ğ»Ğ¾Ğ²Ğ°Ñ‚ÑŒ! {callback.from_user.username}</b>\n",
                                          reply_markup=admin_markup)
        else:
            await callback.message.answer("ğŸ‰ğŸ‰ğŸ‰ğŸ‰ğŸ‰ EVENTBOT ğŸ‰ğŸ‰ğŸ‰ğŸ‰ğŸ‰\n\n"
                                          f"<b>Ğ”Ğ¾Ğ±Ñ€Ğ¾ Ğ¿Ğ¾Ğ¶Ğ°Ğ»Ğ¾Ğ²Ğ°Ñ‚ÑŒ! {callback.from_user.username}</b>\n",
                                          reply_markup=reg_user_markup)
    else:
        await callback.message.answer("ğŸ‰ğŸ‰ğŸ‰ğŸ‰ğŸ‰ EVENTBOT ğŸ‰ğŸ‰ğŸ‰ğŸ‰ğŸ‰\n\n"
                                      f"<b>Ğ’Ñ‹ Ğ½Ğµ Ğ¿Ñ€Ğ¾ÑˆĞ»Ğ¸ Ñ€ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ°Ñ†Ğ¸Ñ\n"
                                      f"ĞŸĞ¾Ğ¶Ğ°Ğ»ÑƒĞ¹ÑÑ‚Ğ° Ğ¿Ñ€Ğ¾Ğ¹Ğ´Ğ¸Ñ‚Ğµ Ñ€ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ°Ñ†Ğ¸Ñ</b?>")
